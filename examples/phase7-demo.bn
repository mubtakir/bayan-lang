// ============================================
// Ù…Ø«Ø§Ù„ Ø´Ø§Ù…Ù„: Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7 - Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
// Comprehensive Example: Phase 7 - Medium Priority Improvements
// ============================================

// ============================================
// 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª ÙˆØ§Ù„Ø´Ùƒ
// Probability and Uncertainty System
// ============================================

import {
  ProbabilityEngine,
  ProbabilisticRule,
  Evidence,
  EvidenceType,
  ProbabilityLevel,
  CombinationMethod
} from '../src/probability/probabilityEngine';

console.log('=== Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª ÙˆØ§Ù„Ø´Ùƒ ===\n');

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª
const probEngine = new ProbabilityEngine();

// Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ø§Ø¦Ù‚ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©
probEngine.addFact('Ø³ÙŠÙ…Ø·Ø± ØºØ¯Ø§Ù‹', 0.6);
probEngine.addFact('ØºÙŠÙˆÙ… Ø¯Ø§ÙƒÙ†Ø©', 0.8);
probEngine.addFact('Ø±Ø·ÙˆØ¨Ø© Ø¹Ø§Ù„ÙŠØ©', 0.7);

// Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ù„Ø©
const evidence1 = new Evidence('ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù‚Ø³', EvidenceType.SUPPORTING, 0.9, 'Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ø±ØµØ§Ø¯');
const evidence2 = new Evidence('Ø§Ù„Ø³Ù…Ø§Ø¡ ØµØ§ÙÙŠØ©', EvidenceType.CONTRADICTING, 0.3, 'Ù…Ù„Ø§Ø­Ø¸Ø© Ø´Ø®ØµÙŠØ©');

probEngine.addEvidence('Ø³ÙŠÙ…Ø·Ø± ØºØ¯Ø§Ù‹', evidence1);
probEngine.addEvidence('Ø³ÙŠÙ…Ø·Ø± ØºØ¯Ø§Ù‹', evidence2);

// Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ù„Ø©
const rainFact = probEngine.getFact('Ø³ÙŠÙ…Ø·Ø± ØºØ¯Ø§Ù‹');
console.log(`${rainFact.toString()}`);
console.log(`Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯Ù„Ø©: ${rainFact.evidence.length}\n`);

// Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©
const premises = new Map();
premises.set('ØºÙŠÙˆÙ… Ø¯Ø§ÙƒÙ†Ø©', 0.7);
premises.set('Ø±Ø·ÙˆØ¨Ø© Ø¹Ø§Ù„ÙŠØ©', 0.6);

const rainRule = new ProbabilisticRule(
  'Ù‚Ø§Ø¹Ø¯Ø©_Ø§Ù„Ù…Ø·Ø±',
  premises,
  'Ù…Ø·Ø±_Ù…Ø­ØªÙ…Ù„',
  0.85
);

probEngine.addRule(rainRule);

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯
const newFacts = probEngine.applyRules();
console.log(`ØªÙ… Ø§Ø³ØªÙ†ØªØ§Ø¬ ${newFacts.length} Ø­Ù‚Ø§Ø¦Ù‚ Ø¬Ø¯ÙŠØ¯Ø©:`);
for (const fact of newFacts) {
  console.log(`  - ${fact.toString()}`);
}

// Ø¯Ù…Ø¬ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª
const p1 = 0.7;
const p2 = 0.8;
console.log(`\nØ¯Ù…Ø¬ Ø§Ø­ØªÙ…Ø§Ù„ÙŠÙ† (${p1}, ${p2}):`);
console.log(`  Ø§Ù„Ù…ØªÙˆØ³Ø·: ${probEngine.combineProbabilities(p1, p2, CombinationMethod.AVERAGE)}`);
console.log(`  Ø¨Ø§ÙŠØ²ÙŠ: ${probEngine.combineProbabilities(p1, p2, CombinationMethod.BAYESIAN).toFixed(3)}`);

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ù‚Ø§Ø¦Ù‚ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„
const highProbFacts = probEngine.getFactsAboveThreshold(0.7);
console.log(`\nØ­Ù‚Ø§Ø¦Ù‚ ÙÙˆÙ‚ 70%:`);
for (const fact of highProbFacts) {
  console.log(`  - ${fact.toString()}`);
}

// Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
const probStats = probEngine.getStatistics();
console.log(`\nØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª:`);
console.log(`  Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚: ${probStats.totalFacts}`);
console.log(`  Ø­Ù‚Ø§Ø¦Ù‚ Ù…Ø¤ÙƒØ¯Ø© (>90%): ${probStats.certainFacts}`);
console.log(`  Ø­Ù‚Ø§Ø¦Ù‚ ØºÙŠØ± Ù…Ø¤ÙƒØ¯Ø© (<50%): ${probStats.uncertainFacts}`);
console.log(`  Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„: ${(probStats.averageProbability * 100).toFixed(1)}%`);

// ============================================
// 2. Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„ØªØ®Ø·ÙŠØ·
// Goals and Planning System
// ============================================

import {
  GoalEngine,
  Goal,
  Action,
  Condition,
  GoalState,
  GoalPriority,
  GoalType
} from '../src/planning/goalEngine';

console.log('\n\n=== Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„ØªØ®Ø·ÙŠØ· ===\n');

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
const goalEngine = new GoalEngine();

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø£ÙˆÙ„ÙŠ
goalEngine.updateContext('Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', 1);
goalEngine.updateContext('Ø¹Ø¯Ø¯_Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', 0);
goalEngine.updateContext('Ù„Ø¯ÙŠÙƒ_ÙÙƒØ±Ø©', true);

// Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø¯Ù Ø±Ø¦ÙŠØ³ÙŠ
const mainGoal = new Goal(
  'Ø£Ù† Ø£ØµØ¨Ø­ Ù…Ø¨Ø±Ù…Ø¬Ø§Ù‹ Ù…Ø­ØªØ±ÙØ§Ù‹',
  'Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ø­ØªØ±Ø§ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©',
  GoalType.ACHIEVEMENT,
  GoalPriority.CRITICAL,
  [new Condition('Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', '>=', 10)]
);

// Ø¥Ø¶Ø§ÙØ© Ø£Ù‡Ø¯Ø§Ù ÙØ±Ø¹ÙŠØ©
const subgoal1 = new Goal(
  'ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª',
  'Ø¥ØªÙ‚Ø§Ù† Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©',
  GoalType.ACHIEVEMENT,
  GoalPriority.HIGH,
  [new Condition('Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', '>=', 3)]
);

const subgoal2 = new Goal(
  'Ø¨Ù†Ø§Ø¡ Ù…Ø´Ø§Ø±ÙŠØ¹',
  'Ø¨Ù†Ø§Ø¡ 5 Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
  GoalType.ACHIEVEMENT,
  GoalPriority.HIGH,
  [new Condition('Ø¹Ø¯Ø¯_Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', '>=', 5)]
);

const subgoal3 = new Goal(
  'Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙØªÙˆØ­Ø©',
  'Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø±',
  GoalType.ACHIEVEMENT,
  GoalPriority.MEDIUM,
  [new Condition('Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', '>=', 7)]
);

mainGoal.addSubgoal(subgoal1);
mainGoal.addSubgoal(subgoal2);
mainGoal.addSubgoal(subgoal3);

goalEngine.addGoal(mainGoal);
goalEngine.addGoal(subgoal1);
goalEngine.addGoal(subgoal2);
goalEngine.addGoal(subgoal3);

// Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
mainGoal.start();
subgoal1.start();

console.log('Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:');
console.log(`  ${mainGoal.toString()}`);
console.log(`    ${subgoal1.toString()}`);
console.log(`    ${subgoal2.toString()}`);
console.log(`    ${subgoal3.toString()}`);

// Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
const action1 = new Action(
  'Ø¯Ø±Ø§Ø³Ø© Ø¯ÙˆØ±Ø©',
  'Ø¯Ø±Ø§Ø³Ø© Ø¯ÙˆØ±Ø© Ø¨Ø±Ù…Ø¬Ø©',
  [new Condition('Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', '<', 10)],
  new Map([['Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', 3]]),
  5
);

const action2 = new Action(
  'Ø¨Ù†Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹',
  'Ø¨Ù†Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯',
  [
    new Condition('Ù„Ø¯ÙŠÙƒ_ÙÙƒØ±Ø©', '==', true),
    new Condition('Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', '>=', 2)
  ],
  new Map([['Ø¹Ø¯Ø¯_Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', 1]]),
  10
);

goalEngine.addAction(action1);
goalEngine.addAction(action2);

// Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„ØªØ­Ù‚ÙŠÙ‚ Ù‡Ø¯Ù
const plan = goalEngine.planForGoal('ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª');
if (plan) {
  console.log(`\n${plan.toString()}`);
}

// Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
console.log('\n--- Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªÙ‚Ø¯Ù… ---');
goalEngine.updateContext('Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©', 3);
let achieved = goalEngine.checkGoals();
console.log(`ØªÙ… ØªØ­Ù‚ÙŠÙ‚ ${achieved.length} Ù‡Ø¯Ù`);

mainGoal.updateProgress();
console.log(`ØªÙ‚Ø¯Ù… Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: ${mainGoal.progress.toFixed(0)}%`);

goalEngine.updateContext('Ø¹Ø¯Ø¯_Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', 5);
achieved = goalEngine.checkGoals();
console.log(`ØªÙ… ØªØ­Ù‚ÙŠÙ‚ ${achieved.length} Ù‡Ø¯Ù Ø¥Ø¶Ø§ÙÙŠ`);

mainGoal.updateProgress();
console.log(`ØªÙ‚Ø¯Ù… Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: ${mainGoal.progress.toFixed(0)}%`);

// Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
const goalStats = goalEngine.getStatistics();
console.log(`\nØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:`);
console.log(`  Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${goalStats.totalGoals}`);
console.log(`  Ù…Ø¹Ù„Ù‚Ø©: ${goalStats.pending}`);
console.log(`  Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°: ${goalStats.inProgress}`);
console.log(`  Ù…Ø­Ù‚Ù‚Ø©: ${goalStats.achieved}`);

// ============================================
// 3. Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
// Performance Improvements System
// ============================================

import {
  PerformanceEngine,
  Cache
} from '../src/performance/performanceEngine';

console.log('\n\n=== Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ ===\n');

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£Ø¯Ø§Ø¡
const perfEngine = new PerformanceEngine(100, 5000); // cache size=100, TTL=5s

// 1. Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
console.log('--- Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª ---');

let callCount = 0;
const expensiveCalculation = (n: number) => {
  callCount++;
  console.log(`  Ø­Ø³Ø§Ø¨ ÙÙŠØ¨ÙˆÙ†Ø§ØªØ´ÙŠ(${n})... [Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ #${callCount}]`);
  
  if (n <= 1) return n;
  let a = 0, b = 1;
  for (let i = 2; i <= n; i++) {
    const temp = a + b;
    a = b;
    b = temp;
  }
  return b;
};

// Ø£ÙˆÙ„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ - Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨
const result1 = perfEngine.withCache('fib_10', () => expensiveCalculation(10));
console.log(`  Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${result1}`);

// Ø«Ø§Ù†ÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ - Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
const result2 = perfEngine.withCache('fib_10', () => expensiveCalculation(10));
console.log(`  Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${result2}`);

console.log(`Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©: ${callCount} (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 1)`);

// 2. Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡
console.log('\n--- Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡ ---');

perfEngine.withBenchmark('Ø­Ø³Ø§Ø¨_Ù…Ø¬Ù…ÙˆØ¹', () => {
  let sum = 0;
  for (let i = 0; i < 1000000; i++) {
    sum += i;
  }
  return sum;
});

perfEngine.withBenchmark('Ø­Ø³Ø§Ø¨_Ù…Ø¬Ù…ÙˆØ¹', () => {
  let sum = 0;
  for (let i = 0; i < 1000000; i++) {
    sum += i;
  }
  return sum;
});

const benchStats = perfEngine.benchmark.getStatistics('Ø­Ø³Ø§Ø¨_Ù…Ø¬Ù…ÙˆØ¹');
if (benchStats) {
  console.log(`Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª: ${benchStats.count}`);
  console.log(`Ø§Ù„Ø£Ø³Ø±Ø¹: ${benchStats.min.toFixed(2)}ms`);
  console.log(`Ø§Ù„Ø£Ø¨Ø·Ø£: ${benchStats.max.toFixed(2)}ms`);
  console.log(`Ø§Ù„Ù…ØªÙˆØ³Ø·: ${benchStats.average.toFixed(2)}ms`);
}

// 3. Ø§Ù„ÙÙ‡Ø±Ø³Ø©
console.log('\n--- Ø§Ù„ÙÙ‡Ø±Ø³Ø© ---');

const users = [
  { id: 1, name: 'Ø£Ø­Ù…Ø¯', age: 25, city: 'Ø§Ù„Ø±ÙŠØ§Ø¶' },
  { id: 2, name: 'Ù…Ø­Ù…Ø¯', age: 30, city: 'Ø¬Ø¯Ø©' },
  { id: 3, name: 'Ø¹Ù„ÙŠ', age: 25, city: 'Ø§Ù„Ø±ÙŠØ§Ø¶' },
  { id: 4, name: 'ÙØ§Ø·Ù…Ø©', age: 28, city: 'Ø¬Ø¯Ø©' }
];

perfEngine.index.createIndex('age');
perfEngine.index.createIndex('city');

for (const user of users) {
  perfEngine.index.add(user, 'age', user.age);
  perfEngine.index.add(user, 'city', user.city);
}

const age25 = perfEngine.index.find('age', 25);
console.log(`Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø¨Ø¹Ù…Ø± 25: ${age25.length}`);
for (const user of age25) {
  console.log(`  - ${user.name}`);
}

const riyadh = perfEngine.index.find('city', 'Ø§Ù„Ø±ÙŠØ§Ø¶');
console.log(`Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶: ${riyadh.length}`);
for (const user of riyadh) {
  console.log(`  - ${user.name}`);
}

// Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø©
console.log('\n--- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© ---');
const overallStats = perfEngine.getOverallStatistics();
console.log(`Ø­Ø¬Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª: ${overallStats.cache.size}/${overallStats.cache.maxSize}`);
console.log(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª: ${overallStats.cache.totalHits}`);
console.log(`Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª: ${overallStats.benchmarks.size}`);

// ============================================
// Ø§Ù„Ù†Ù‡Ø§ÙŠØ© - End
// ============================================

console.log('\n\nğŸ‰ Ø§Ù†ØªÙ‡Ù‰ Ù…Ø«Ø§Ù„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7!');
console.log('ØªÙ… Ø¹Ø±Ø¶:');
console.log('âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª ÙˆØ§Ù„Ø´Ùƒ');
console.log('âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„ØªØ®Ø·ÙŠØ·');
console.log('âœ… Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡');

