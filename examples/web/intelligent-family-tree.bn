// ğŸŒ³ Intelligent Family Tree - Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø°ÙƒÙŠØ©
// This example showcases Bayan's unique hybrid paradigm:
// - Logic Programming for family relationships
// - OOP for UI components
// - Procedural for DOM manipulation
// Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù‡Ø¬ÙŠÙ† Ø§Ù„ÙØ±ÙŠØ¯ Ù„Ù„Ø¨ÙŠØ§Ù†:
// - Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ© Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
// - Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙƒØ§Ø¦Ù†ÙŠØ© Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
// - Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ© Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ DOM

hybrid {
    // ==========================================
    // PART 1: Logic Programming - Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©
    // Define family relationships using facts and rules
    // ==========================================
    
    // Facts: Parent relationships - Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚: Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø¨ÙˆØ©
    fact parent("Ø£Ø­Ù…Ø¯", "ÙØ§Ø·Ù…Ø©");
    fact parent("Ø£Ø­Ù…Ø¯", "Ø¹Ù„ÙŠ");
    fact parent("Ø£Ø­Ù…Ø¯", "Ø³Ø§Ø±Ø©");
    fact parent("ÙØ§Ø·Ù…Ø©", "Ø¹Ù…Ø±");
    fact parent("ÙØ§Ø·Ù…Ø©", "Ù„ÙŠÙ„Ù‰");
    fact parent("Ø¹Ù„ÙŠ", "Ø®Ø§Ù„Ø¯");
    fact parent("Ø¹Ù„ÙŠ", "Ù†ÙˆØ±");
    fact parent("Ø³Ø§Ø±Ø©", "Ø²ÙŠÙ†Ø¨");
    
    fact parent("Ahmed", "Fatima");
    fact parent("Ahmed", "Ali");
    fact parent("Ahmed", "Sara");
    fact parent("Fatima", "Omar");
    fact parent("Fatima", "Layla");
    fact parent("Ali", "Khaled");
    fact parent("Ali", "Noor");
    fact parent("Sara", "Zainab");
    
    // Facts: Gender - Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚: Ø§Ù„Ø¬Ù†Ø³
    fact male("Ø£Ø­Ù…Ø¯");
    fact male("Ø¹Ù„ÙŠ");
    fact male("Ø¹Ù…Ø±");
    fact male("Ø®Ø§Ù„Ø¯");
    fact female("ÙØ§Ø·Ù…Ø©");
    fact female("Ø³Ø§Ø±Ø©");
    fact female("Ù„ÙŠÙ„Ù‰");
    fact female("Ù†ÙˆØ±");
    fact female("Ø²ÙŠÙ†Ø¨");
    
    fact male("Ahmed");
    fact male("Ali");
    fact male("Omar");
    fact male("Khaled");
    fact female("Fatima");
    fact female("Sara");
    fact female("Layla");
    fact female("Noor");
    fact female("Zainab");
    
    // Rules: Complex family relationships - Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯: Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ© Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
    
    // Grandparent - Ø§Ù„Ø¬Ø¯/Ø§Ù„Ø¬Ø¯Ø©
    rule grandparent(?gp, ?gc) :- parent(?gp, ?p), parent(?p, ?gc);
    
    // Grandfather - Ø§Ù„Ø¬Ø¯
    rule grandfather(?gf, ?gc) :- grandparent(?gf, ?gc), male(?gf);
    
    // Grandmother - Ø§Ù„Ø¬Ø¯Ø©
    rule grandmother(?gm, ?gc) :- grandparent(?gm, ?gc), female(?gm);
    
    // Sibling - Ø§Ù„Ø£Ø®/Ø§Ù„Ø£Ø®Øª
    rule sibling(?x, ?y) :- parent(?p, ?x), parent(?p, ?y), ?x != ?y;
    
    // Brother - Ø§Ù„Ø£Ø®
    rule brother(?b, ?s) :- sibling(?b, ?s), male(?b);
    
    // Sister - Ø§Ù„Ø£Ø®Øª
    rule sister(?s, ?b) :- sibling(?s, ?b), female(?s);
    
    // Uncle - Ø§Ù„Ø¹Ù…/Ø§Ù„Ø®Ø§Ù„
    rule uncle(?u, ?n) :- parent(?p, ?n), brother(?u, ?p);
    
    // Aunt - Ø§Ù„Ø¹Ù…Ø©/Ø§Ù„Ø®Ø§Ù„Ø©
    rule aunt(?a, ?n) :- parent(?p, ?n), sister(?a, ?p);
    
    // Cousin - Ø§Ø¨Ù†/Ø¨Ù†Øª Ø§Ù„Ø¹Ù… Ø£Ùˆ Ø§Ù„Ø®Ø§Ù„
    rule cousin(?c1, ?c2) :- parent(?p1, ?c1), parent(?p2, ?c2), sibling(?p1, ?p2);
    
    // Ancestor - Ø§Ù„Ø³Ù„Ù
    rule ancestor(?a, ?d) :- parent(?a, ?d);
    rule ancestor(?a, ?d) :- parent(?a, ?x), ancestor(?x, ?d);
    
    // Descendant - Ø§Ù„Ø®Ù„Ù
    rule descendant(?d, ?a) :- ancestor(?a, ?d);
    
    // ==========================================
    // PART 2: OOP - Person Class - Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ÙƒØ§Ø¦Ù†ÙŠØ©
    // ==========================================
    
    class Person {
        constructor(name, arabicName) {
            this.name = name;
            this.arabicName = arabicName;
            this.relationships = {};
        }
        
        // Find all relationships for this person
        findRelationships() {
            const rels = {};
            
            // Children - Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡
            rels.children = this.queryLogic("parent", this.name, "?child");
            rels.childrenAr = this.queryLogic("parent", this.arabicName, "?child");
            
            // Parents - Ø§Ù„Ø¢Ø¨Ø§Ø¡
            rels.parents = this.queryLogic("parent", "?parent", this.name);
            rels.parentsAr = this.queryLogic("parent", "?parent", this.arabicName);
            
            // Grandchildren - Ø§Ù„Ø£Ø­ÙØ§Ø¯
            rels.grandchildren = this.queryLogic("grandparent", this.name, "?gc");
            rels.grandchildrenAr = this.queryLogic("grandparent", this.arabicName, "?gc");
            
            // Grandparents - Ø§Ù„Ø£Ø¬Ø¯Ø§Ø¯
            rels.grandparents = this.queryLogic("grandparent", "?gp", this.name);
            rels.grandparentsAr = this.queryLogic("grandparent", "?gp", this.arabicName);
            
            // Siblings - Ø§Ù„Ø¥Ø®ÙˆØ©
            rels.siblings = this.queryLogic("sibling", this.name, "?sib");
            rels.siblingsAr = this.queryLogic("sibling", this.arabicName, "?sib");
            
            // Uncles - Ø§Ù„Ø£Ø¹Ù…Ø§Ù…/Ø§Ù„Ø£Ø®ÙˆØ§Ù„
            rels.uncles = this.queryLogic("uncle", "?uncle", this.name);
            rels.unclesAr = this.queryLogic("uncle", "?uncle", this.arabicName);
            
            // Aunts - Ø§Ù„Ø¹Ù…Ø§Øª/Ø§Ù„Ø®Ø§Ù„Ø§Øª
            rels.aunts = this.queryLogic("aunt", "?aunt", this.name);
            rels.auntsAr = this.queryLogic("aunt", "?aunt", this.arabicName);
            
            // Cousins - Ø£Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù…/Ø§Ù„Ø®Ø§Ù„
            rels.cousins = this.queryLogic("cousin", this.name, "?cousin");
            rels.cousinsAr = this.queryLogic("cousin", this.arabicName, "?cousin");
            
            // Ancestors - Ø§Ù„Ø£Ø³Ù„Ø§Ù
            rels.ancestors = this.queryLogic("ancestor", "?anc", this.name);
            rels.ancestorsAr = this.queryLogic("ancestor", "?anc", this.arabicName);
            
            // Descendants - Ø§Ù„Ø£Ø®Ù„Ø§Ù
            rels.descendants = this.queryLogic("descendant", "?desc", this.name);
            rels.descendantsAr = this.queryLogic("descendant", "?desc", this.arabicName);
            
            this.relationships = rels;
            return rels;
        }
        
        // Helper to query logic engine
        queryLogic(ruleName, arg1, arg2) {
            // This will be implemented by the logic engine
            // In real implementation, this calls the Bayan logic engine
            return [];
        }
        
        // Get relationship description
        getRelationshipText(relType, lang) {
            const count = lang === "ar" ? 
                (this.relationships[relType + "Ar"] || []).length :
                (this.relationships[relType] || []).length;
            
            if (count === 0) {
                return lang === "ar" ? "Ù„Ø§ ÙŠÙˆØ¬Ø¯" : "None";
            }
            
            const names = lang === "ar" ?
                (this.relationships[relType + "Ar"] || []) :
                (this.relationships[relType] || []);
            
            return names.join(", ");
        }
    }
    
    // ==========================================
    // PART 3: UI Component Class - ØµÙ†Ù Ù…ÙƒÙˆÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    // ==========================================
    
    ØµÙ†Ù Ù…ÙƒÙˆÙ†_Ø´Ø¬Ø±Ø©_Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© {
        Ù…Ù†Ø´Ø¦(Ø¹Ù†ØµØ±_Ø§Ù„Ø­Ø§ÙˆÙŠØ©) {
            Ù‡Ø°Ø§.Ø§Ù„Ø­Ø§ÙˆÙŠØ© = Ø¹Ù†ØµØ±_Ø§Ù„Ø­Ø§ÙˆÙŠØ©;
            Ù‡Ø°Ø§.Ø§Ù„Ø£Ø´Ø®Ø§Øµ = new Map();
            Ù‡Ø°Ø§.Ø§Ù„Ø´Ø®Øµ_Ø§Ù„Ù…Ø®ØªØ§Ø± = null;
            Ù‡Ø°Ø§.Ø§Ù„Ù„ØºØ© = "ar";
        }
        
        Ø¯Ø§Ù„Ø© Ø£Ø¶Ù_Ø´Ø®Øµ(name, arabicName) {
            const person = new Person(name, arabicName);
            person.findRelationships();
            Ù‡Ø°Ø§.Ø§Ù„Ø£Ø´Ø®Ø§Øµ.set(name, person);
            Ù‡Ø°Ø§.Ø§Ù„Ø£Ø´Ø®Ø§Øµ.set(arabicName, person);
            return person;
        }
        
        Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ±_Ø´Ø®Øµ(name) {
            Ù‡Ø°Ø§.Ø§Ù„Ø´Ø®Øµ_Ø§Ù„Ù…Ø®ØªØ§Ø± = Ù‡Ø°Ø§.Ø§Ù„Ø£Ø´Ø®Ø§Øµ.get(name);
            if (Ù‡Ø°Ø§.Ø§Ù„Ø´Ø®Øµ_Ø§Ù„Ù…Ø®ØªØ§Ø±) {
                Ù‡Ø°Ø§.Ø§Ø¹Ø±Ø¶_Ø§Ù„ØªÙØ§ØµÙŠÙ„();
            }
        }
        
        Ø¯Ø§Ù„Ø© Ø¨Ø¯Ù„_Ø§Ù„Ù„ØºØ©() {
            Ù‡Ø°Ø§.Ø§Ù„Ù„ØºØ© = Ù‡Ø°Ø§.Ø§Ù„Ù„ØºØ© === "ar" ? "en" : "ar";
            if (Ù‡Ø°Ø§.Ø§Ù„Ø´Ø®Øµ_Ø§Ù„Ù…Ø®ØªØ§Ø±) {
                Ù‡Ø°Ø§.Ø§Ø¹Ø±Ø¶_Ø§Ù„ØªÙØ§ØµÙŠÙ„();
            }
        }
        
        Ø¯Ø§Ù„Ø© Ø§Ø¹Ø±Ø¶_Ø§Ù„ØªÙØ§ØµÙŠÙ„() {
            const person = Ù‡Ø°Ø§.Ø§Ù„Ø´Ø®Øµ_Ø§Ù„Ù…Ø®ØªØ§Ø±;
            const lang = Ù‡Ø°Ø§.Ø§Ù„Ù„ØºØ©;
            const displayName = lang === "ar" ? person.arabicName : person.name;
            
            let html = `
                <div class="person-details">
                    <h2>${displayName}</h2>
                    <div class="relationships">
            `;
            
            const relTypes = [
                { key: "parents", ar: "Ø§Ù„Ø¢Ø¨Ø§Ø¡", en: "Parents" },
                { key: "children", ar: "Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡", en: "Children" },
                { key: "grandparents", ar: "Ø§Ù„Ø£Ø¬Ø¯Ø§Ø¯", en: "Grandparents" },
                { key: "grandchildren", ar: "Ø§Ù„Ø£Ø­ÙØ§Ø¯", en: "Grandchildren" },
                { key: "siblings", ar: "Ø§Ù„Ø¥Ø®ÙˆØ©", en: "Siblings" },
                { key: "uncles", ar: "Ø§Ù„Ø£Ø¹Ù…Ø§Ù…", en: "Uncles" },
                { key: "aunts", ar: "Ø§Ù„Ø¹Ù…Ø§Øª", en: "Aunts" },
                { key: "cousins", ar: "Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡", en: "Cousins" },
                { key: "ancestors", ar: "Ø§Ù„Ø£Ø³Ù„Ø§Ù", en: "Ancestors" },
                { key: "descendants", ar: "Ø§Ù„Ø£Ø®Ù„Ø§Ù", en: "Descendants" }
            ];
            
            for (const rel of relTypes) {
                const label = lang === "ar" ? rel.ar : rel.en;
                const value = person.getRelationshipText(rel.key, lang);
                html = html + `
                    <div class="rel-row">
                        <span class="rel-label">${label}:</span>
                        <span class="rel-value">${value}</span>
                    </div>
                `;
            }
            
            html = html + `
                    </div>
                </div>
            `;
            
            const detailsDiv = document.getElementById("details");
            if (detailsDiv) {
                detailsDiv.innerHTML = html;
            }
        }
        
        Ø¯Ø§Ù„Ø© Ø§Ø±Ø³Ù…_Ø§Ù„Ø´Ø¬Ø±Ø©() {
            // Draw the family tree visualization
            // This would use SVG or Canvas in a real implementation
            const treeDiv = document.getElementById("tree");
            if (!treeDiv) {
                return;
            }
            
            let html = '<div class="tree-container">';
            
            // Generation 1: Grandparent
            html = html + '<div class="generation">';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ø£Ø­Ù…Ø¯\')">Ø£Ø­Ù…Ø¯<br>Ahmed</div>';
            html = html + '</div>';
            
            // Generation 2: Parents
            html = html + '<div class="generation">';
            html = html + '<div class="person-node" onclick="selectPerson(\'ÙØ§Ø·Ù…Ø©\')">ÙØ§Ø·Ù…Ø©<br>Fatima</div>';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ø¹Ù„ÙŠ\')">Ø¹Ù„ÙŠ<br>Ali</div>';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ø³Ø§Ø±Ø©\')">Ø³Ø§Ø±Ø©<br>Sara</div>';
            html = html + '</div>';
            
            // Generation 3: Children
            html = html + '<div class="generation">';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ø¹Ù…Ø±\')">Ø¹Ù…Ø±<br>Omar</div>';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ù„ÙŠÙ„Ù‰\')">Ù„ÙŠÙ„Ù‰<br>Layla</div>';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ø®Ø§Ù„Ø¯\')">Ø®Ø§Ù„Ø¯<br>Khaled</div>';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ù†ÙˆØ±\')">Ù†ÙˆØ±<br>Noor</div>';
            html = html + '<div class="person-node" onclick="selectPerson(\'Ø²ÙŠÙ†Ø¨\')">Ø²ÙŠÙ†Ø¨<br>Zainab</div>';
            html = html + '</div>';
            
            html = html + '</div>';
            
            treeDiv.innerHTML = html;
        }
    }
    
    // ==========================================
    // PART 4: Procedural - Initialization - Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ©
    // ==========================================
    
    // Global component instance
    let familyTreeComponent = null;
    
    function initializeFamilyTree() {
        const container = document.getElementById("app");
        if (!container) {
            return;
        }
        
        // Create component
        familyTreeComponent = new Ù…ÙƒÙˆÙ†_Ø´Ø¬Ø±Ø©_Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©(container);
        
        // Add all people
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Ahmed", "Ø£Ø­Ù…Ø¯");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Fatima", "ÙØ§Ø·Ù…Ø©");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Ali", "Ø¹Ù„ÙŠ");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Sara", "Ø³Ø§Ø±Ø©");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Omar", "Ø¹Ù…Ø±");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Layla", "Ù„ÙŠÙ„Ù‰");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Khaled", "Ø®Ø§Ù„Ø¯");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Noor", "Ù†ÙˆØ±");
        familyTreeComponent.Ø£Ø¶Ù_Ø´Ø®Øµ("Zainab", "Ø²ÙŠÙ†Ø¨");
        
        // Draw the tree
        familyTreeComponent.Ø§Ø±Ø³Ù…_Ø§Ù„Ø´Ø¬Ø±Ø©();
        
        // Select first person
        familyTreeComponent.Ø§Ø®ØªØ±_Ø´Ø®Øµ("Ø£Ø­Ù…Ø¯");
    }
    
    function selectPerson(name) {
        if (familyTreeComponent) {
            familyTreeComponent.Ø§Ø®ØªØ±_Ø´Ø®Øµ(name);
        }
    }
    
    function toggleLanguage() {
        if (familyTreeComponent) {
            familyTreeComponent.Ø¨Ø¯Ù„_Ø§Ù„Ù„ØºØ©();
        }
    }
    
    // Auto-initialize when DOM is ready
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializeFamilyTree);
    } else {
        initializeFamilyTree();
    }
}

